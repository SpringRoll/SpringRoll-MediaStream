/*! MediaStream 1.0.0 */
!function(){"use strict";!function(a){var b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=!1,l=!1,m=function(a){if(a&&(a.video||a.audio)){var g=this;e=a,b={},app.on("paused",o),app.on("resumed",p),void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(a){var c=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return c||(b={},b.isSupported=!1,b.error="streaming is not supported by this browser."),new Promise(function(b,d){c.call(navigator,a,b,d)})}),s(function(a){j=a,j&&e.video?(h=0,e.video={deviceId:!j[h].deviceId||{exact:j[h].deviceId}}):e.video=!1,navigator.mediaDevices.getUserMedia(e).then(function(a){d=a,e.audio&&q(),e.video&&(f=document.createElement("video"),r()),b={},b.video=f,b.audio=c,g.onLoad(b)}).catch(function(a){b.error||(b={},b.isSupported=!0,b.error=a.message),g.onLoad(b)})})}},n=extend(m),o=function(){null!==d&&(e.audio&&c.context.suspend(),e.video&&f.pause())},p=function(){null!==d&&(k&&e.audio&&c.context.resume(),l&&e.video&&f.play())},q=function(){AudioContext=AudioContext||webkitAudioContext,g=new AudioContext,i=g.createBiquadFilter(),i.type="lowshelf",i.frequency.value=10,i.gain.value=0,c=g.createMediaStreamSource(d),n.audioPlay()},r=function(){f.src=URL&&URL.createObjectURL(d)||d,f.muted="true",f.autoplay="autoplay",n.videoPlay()},s=function(a){void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(b){for(var c=b.length-1;c>=0;c--)"videoinput"!==b[c].kind&&b.splice(c,1);a(b)}).catch(function(b){a(!1)}):a(!1)};n.audioPause=function(){k=!1,c.context.suspend()},n.audioPlay=function(){k=!0,c.context.resume()},n.videoPause=function(){l=!1,f.pause()},n.videoPlay=function(){l=!0,f.play()},n.audioMute=function(){c.disconnect(),i.disconnect()},n.audioUnmute=function(){c.connect(i),i.connect(g.destination)},n.getNextVideoSource=function(a){j.length>1&&(h++,h>=j.length&&(h=0),e.video={deviceId:!j[h].deviceId||{exact:j[h].deviceId}},n.destroy(d.getVideoTracks()),navigator.mediaDevices.getUserMedia(e).then(function(c){d=c,e.video&&r(),b={},b.video=f,a(b)}).catch(function(c){b.error||(b={},b.isSupported=!0,b.error=c.message),a(b)}))},n.destroy=function(a){a||(a=d.getTracks()),a.forEach(function(a){a.stop()})},namespace("springroll").MediaStream=m}(window);}();